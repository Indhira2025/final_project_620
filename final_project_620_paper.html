<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>From Outbrek to Endemic: Covid-19 in the US</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="final_project_620_paper_files/libs/clipboard/clipboard.min.js"></script>
<script src="final_project_620_paper_files/libs/quarto-html/quarto.js"></script>
<script src="final_project_620_paper_files/libs/quarto-html/popper.min.js"></script>
<script src="final_project_620_paper_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="final_project_620_paper_files/libs/quarto-html/anchor.min.js"></script>
<link href="final_project_620_paper_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="final_project_620_paper_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="final_project_620_paper_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="final_project_620_paper_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="final_project_620_paper_files/libs/bootstrap/bootstrap-8a79a254b8e706d3c925cde0a310d4f0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">From Outbrek to Endemic: Covid-19 in the US</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="section" class="level1">
<h1></h1>
<p>Indhira Vadivel, Isha Khapre, Medha Rao</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The COVID-19 pandemic represents one of the most consequential public health crises of the 21st century. Since the first confirmed U.S. cases in early 2020, the nation has faced an evolving series of challenges in containing the virus, managing its health effects, and grappling with its far-reaching societal disruptions. The initial phase of the pandemic was marked by limited testing, widespread uncertainty, and rapidly rising transmission rates, quickly escalating the crisis to a national emergency. Over time, the landscape of the pandemic shifted as vaccines were developed and deployed, public health strategies adapted, and the virus evolved into new variants. By early 2025, COVID-19 had transitioned from an acute pandemic into a more endemic condition—still impactful, but with changing dynamics.</p>
<p>This paper presents a comprehensive analysis of COVID-19 mortality in the United States from 2020 through early 2025. Our central goal is to visualize and interpret how death rates changed over time, with a focus on identifying and characterizing distinct “waves” of elevated mortality. These pandemic waves, defined by periods of increased case counts and deaths, offer valuable insight into how the virus spread, how new variants influenced severity, and how public health responses shaped outcomes. Understanding these trends is crucial for contextualizing the overall trajectory of the pandemic.</p>
<p>Importantly, the effects of COVID-19 were not experienced uniformly across the country. States and regions varied widely in the timing, intensity, and consequences of outbreaks. Differences in public health policies, population density, health care capacity, vaccination uptake, and social behaviors all contributed to this geographic variation. To better understand these disparities, we examine the spatial distribution of COVID-19 deaths and excess mortality at both the state and U.S. Census region levels.</p>
<p>A key focus of our analysis is on how mortality patterns changed across successive waves. Early variants of the virus were associated with high death rates, particularly among older adults and those with pre-existing conditions. However, as more transmissible variants like Delta and Omicron emerged, the profile of disease severity shifted. We explore how rising population immunity—through vaccination and prior infection—alongside improved treatment strategies may have contributed to changing patterns of mortality risk.</p>
<p>Beyond official COVID-19 deaths, we analyze excess mortality as a broader metric of the pandemic’s toll. This measure captures deaths above expected baselines, encompassing not only directly attributed COVID-19 fatalities but also indirect deaths caused by disruptions to health care, mental health impacts, and economic instability. By comparing excess mortality across states and over time, we aim to identify consistent patterns and investigate whether some states faced disproportionate impacts.</p>
<p>Finally, we consider the possibility of misclassified deaths, especially during the early stages of the pandemic when testing capacity was limited. By analyzing trends in pneumonia-related mortality, which may overlap clinically with COVID-19, we explore whether some early fatalities were undercounted or misattributed.&nbsp;</p>
<p>Through this multifaceted approach, our study provides a data-driven account of the COVID-19 pandemic’s evolving impact in the United States. By integrating time trends, geographic disparities, and clinical indicators, we aim to contribute to a deeper understanding of the crisis and inform strategies for managing future infectious disease threats.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>To analyze COVID-19 mortality trends and excess deaths in the United States from 2020 to 2025, we obtained publicly available data from the <strong>Centers for Disease Control and Prevention (CDC)</strong>. Specifically, we accessed datasets containing information on confirmed COVID-19 cases, hospitalizations, deaths, and vaccination coverage through the CDC’s open data portal (<a href="https://data.cdc.gov/" class="uri">https://data.cdc.gov/</a>), using API endpoints and automated querying. The datasets used included:</p>
<ul>
<li><p><strong>COVID-19 Cases</strong>&nbsp;</p></li>
<li><p><strong>COVID-19 Hospitalizations</strong></p></li>
<li><p><strong>COVID-19 Deaths</strong></p></li>
<li><p><strong>COVID-19 Vaccinations</strong>&nbsp;</p></li>
</ul>
<p>To streamline data access and ensure reproducibility, we built a custom function in R using the httr2 package, which allowed for efficient API calls and retrieval of large datasets (up to 10 million records per query).</p>
<section id="visualization-and-analysis-of-covid-19-deaths" class="level3">
<h3 class="anchored" data-anchor-id="visualization-and-analysis-of-covid-19-deaths">Visualization and Analysis of Covid-19 Deaths</h3>
<p><strong>Data Processing and Cleaning<br>
</strong> We used a state-level COVID-19 mortality dataset and excluded national aggregates to focus on regional and state-specific trends. Dates were converted to Date format, and MMWR week and year variables were derived using the epiyear() and epiweek() functions from the epitools package. COVID-19 death counts were converted to numeric values, and only data from January 1, 2020, onwards were retained. All variable names and formats were standardized using the janitor package to ensure consistency.</p>
<p><strong>Computation of Daily and Rolling Mortality Trends<br>
</strong> &nbsp;To explore national mortality trends, daily COVID-19 deaths were aggregated across states, and a 7-day rolling average was computed using the zoo package to smooth short-term fluctuations. This time series enabled identification of major waves in mortality patterns.</p>
<p><strong>Wave Classification and Variant Overlay<br>
</strong> &nbsp;We manually defined six distinct pandemic waves corresponding to dominant SARS-CoV-2 variants based on CDC reports and literature. These wave periods were labeled using the tibble package and overlaid as shaded intervals onto national mortality plots using ggplot2::geom_rect() alongside the rolling average trend line.</p>
<p><strong>State-Level Quarterly Mortality Visualization<br>
</strong> &nbsp;We created a heatmap of state-level COVID-19 deaths by calendar quarter to explore geographic variation. Weekly data were aggregated to state-quarters using lubridate::quarter() and visualized with geom_tile() and the viridis::magma color scale, enabling comparison across regions and time.</p>
<p><strong>Integration of Population and Regional Data<br>
</strong> &nbsp;State-level population estimates from 2020–2024 were retrieved from <a href="https://api.census.gov/data"><strong>https://api.census.gov/data</strong></a>and were merged with weekly death data to calculate per capita mortality rates. Regional classification data were parsed from a JSON file and joined with state data. Weekly observations were matched by state and year using MMWR-aligned dates, resulting in a unified dataset (datdeaths) for regional and temporal analysis.</p>
<p><strong>COVID-19 Death Rates by Variant Wave and Region<br>
</strong> &nbsp;Weekly deaths were categorized into six pandemic waves. For each wave and region, we calculated average weekly COVID-19 death rates per 100,000 people using population-matched data. Bar plots and line graphs visualized regional differences, while tables and faceted bar charts highlighted top states by mortality within each wave.</p>
<p><strong>Temporal Trends of COVID-19 Deaths by State<br>
</strong> &nbsp;We identified the top five states with the highest wave-specific death rates and plotted weekly deaths over time using faceted line plots. LOESS curves were overlaid to visualize trends, allowing comparison across states and variant periods.</p>
<p><strong>Identification of Top States by Annual COVID-19 Death Rate<br>
</strong> &nbsp;To highlight states most impacted annually, we computed yearly death rates per 100,000 population for each state (2020–2024). The top state per year (based on death rate) was identified and displayed in a summary table. A corresponding bar plot illustrated these top states over time, aiding in the visualization of annual mortality burdens and shifts in geographic impact.</p>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#getwd()</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"./code/finalprojectcode.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_620_paper_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(topstate_by_wave_v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  state_name    wave             total_deaths avg_population death_rate_per_100k
  &lt;chr&gt;         &lt;chr&gt;                   &lt;dbl&gt;          &lt;dbl&gt;               &lt;dbl&gt;
1 Mississippi   1st Wave: Origi…        20130       2955774.               681. 
2 West Virginia 4th Wave: Omicr…         5977       1776647.               336. 
3 Florida       3rd Wave: Delta         46657      21781128                214. 
4 Kentucky      5th Wave: Omicr…         8831       4531200.               195. 
5 Kentucky      6th Wave:Omicro…         6060       4577532.               132. 
6 Michigan      2nd Wave: Alpha          7916      10050811                 78.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(top_state_per_year_v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

Table: Table 2: Summary - States with highest death rate (by year)

| Year|State         | Covid_Deaths| Population| Death_rate_per_100k|
|----:|:-------------|------------:|----------:|-------------------:|
| 2020|Mississippi   |        17641|    2956870|           596.61061|
| 2021|West Virginia |        10084|    1782959|           565.57666|
| 2022|West Virginia |         4084|    1774122|           230.19837|
| 2023|Kentucky      |         5597|    4550595|           122.99491|
| 2024|Kentucky      |         3406|    4588372|            74.23112|</code></pre>
</div>
</div>
<p>Figure 1(top left) illustrates weekly COVID-19 death counts in the United States from 2020 through early 2025, overlaid with periods corresponding to six major variant waves. The highest peak occurred during the 1st Wave (Original strain) in late 2020 to early 2021, surpassing 100,000 weekly deaths at its peak. A secondary spike occurred during the 3rd Wave (Delta variant) in mid-to-late 2021, with a notable rise again in early 2022 during the 4th Wave (Omicron BA.1). Following this period, death counts steadily declined, with subsequent waves showing relatively smaller surges. The visualization underscores a sharp decline in mortality as newer Omicron subvariants emerged, suggesting changes in population immunity, viral virulence, or treatment efficacy over time.</p>
<p>Figure 1(top-right)&nbsp; displays a heatmap of quarterly COVID-19 deaths across U.S. states. The highest death tolls are concentrated between Q4 2020 and Q1 2022, with particularly high numbers in California, Texas, Florida, and New York during these periods. Some states in the South and West, such as Arizona, Mississippi, and Alabama, consistently showed elevated death counts across multiple quarters. After Q2 2022, COVID-19 deaths declined significantly across all states and remained at lower levels through 2024 and early 2025. This heatmap highlights temporal and geographic heterogeneity in mortality, potentially linked to health infrastructure, public health responses, and socio-demographic factors.</p>
<p>Figure 1(bottom-left) shows the trend in COVID-19 death rates (per 100,000 people) by U.S. region across the six variant waves. The Southeast region exhibited the highest death rate during the 1st Wave, exceeding 3,900 deaths per 100,000. Although all regions experienced a general decline in death rates across waves, the South Central and Mountain States consistently reported higher mortality compared to other regions, such as New England or the Pacific Northwest. This trend suggests regional disparities in pandemic impact that persisted even as the virus evolved and vaccines became widely available.</p>
<p>Figure 1(bottom-right) focuses on the top five states with the highest death rates per 100,000 for each wave. The affected states varied across waves, with Mississippi, Alabama, and Oklahoma appearing frequently in the top ranks. The 2nd Wave (Alpha) was notable for a shift toward northeastern states, including New Jersey and Pennsylvania. During the Delta and Omicron waves, Southern and Appalachian states, including Kentucky, West Virginia, and Tennessee, were disproportionately represented. Puerto Rico also emerged during the 5th Wave, illustrating how regional vulnerabilities extended beyond the continental U.S.</p>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>This study presents a comprehensive analysis of COVID-19 mortality in the United States from 2020 through early 2025, revealing key temporal, geographic, and variant-specific patterns, as well as shifts in disease severity and excess mortality over time. Our findings show that the overall burden of COVID-19 deaths peaked during the early stages of the pandemic and again during the Delta wave, with mortality declining substantially during the later Omicron waves. This trajectory suggests the influence of evolving viral characteristics, population-level immunity, public health interventions, and improvements in clinical management.</p>
<p>Geographically, we observed persistent disparities in mortality throughout the pandemic. Southern and Appalachian states, along with parts of the Midwest, consistently experienced higher death rates compared to other regions. These states frequently appeared among the top five in per capita COVID-19 mortality during multiple variant waves. Factors likely contributing to these disparities include lower vaccination coverage, higher prevalence of chronic diseases, and reduced access to healthcare resources. Conversely, northeastern states, which were heavily affected in the initial wave, appeared less frequently in later waves, possibly due to early surges driving more robust public health responses or higher subsequent immunity. These trends highlight the ongoing importance of addressing structural health inequities in regional pandemic preparedness.</p>
<p>Temporal analysis across variant waves revealed a non-linear trend in hospitalization and mortality metrics. Although hospitalizations per 1,000 cases decreased between the Original and Delta waves, they resurged during later Omicron subvariant periods, particularly BA.2 to XBB. This bimodal trend may reflect a dynamic virulence-immunity tradeoff, where the virus evolved to maintain high transmissibility despite partial immune protection in the population. In contrast, case fatality rates (CFRs) declined steadily across waves. This monotonic decline, confirmed through chi-squared comparisons and mortality rate ratios, points toward a genuine reduction in disease severity over time. Likely contributing factors include mass vaccination, earlier detection and treatment, as well as accumulated population immunity through prior infection.</p>
<p>Still, these patterns must be interpreted within a broader public health context. Vaccination coverage increased steadily across waves and was strongly associated with lower excess mortality. However, improvements in clinical management (e.g., increased use of dexamethasone and remdesivir post-2021), greater availability of home testing during Omicron surges, and high rates of prior infection (with estimates suggesting over 58% of Americans had been infected by 2023) also likely contributed to the observed reductions in severity. These interacting factors complicate efforts to attribute mortality reductions to any single cause and underscore the need for multifaceted public health strategies.</p>
<p>Our analysis of excess mortality adds further depth to these findings. The Delta wave and the early pandemic phase were associated with the highest percentages of excess deaths, consistent with their documented impact on hospital systems and public health infrastructure. Western states, including Arizona and New Mexico, reported some of the highest levels of excess mortality across multiple waves, while northeastern states like New Jersey more frequently appeared among those with lower relative burden. One possible explanation for this pattern is the greater healthcare capacity and urban infrastructure in the Northeast, which may have mitigated severe outcomes.</p>
<p>Regression analysis also revealed important interactions among causes of death. COVID-19 deaths were the strongest predictor of excess mortality, but pneumonia-related deaths showed a significant interaction, suggesting that pneumonia often served as a secondary complication rather than a source of misclassification. Influenza, while statistically significant, had a negative interaction with COVID-19 mortality. This may reflect reduced influenza transmission due to social distancing or potential over-attribution of deaths to influenza during overlapping respiratory illness seasons.</p>
<p>Several limitations should be acknowledged. First, mortality reporting lags—ranging from 2 to 8 weeks—introduce uncertainty in the temporal alignment of peaks and variant-specific waves. Additionally, the dataset did not distinguish between influenza-only deaths and those involving co-infections, possibly inflating influenza’s apparent impact. Moreover, home testing and shifts in death attribution practices may have affected both case and death reporting over time, particularly during the Omicron period.</p>
<p>Despite these limitations, the findings provide critical insights into how the evolving virology of SARS-CoV-2, combined with public health responses and sociodemographic context, shaped the trajectory of the pandemic in the United States. Importantly, the regional and temporal heterogeneity in mortality reinforces the need for locally tailored strategies, ongoing surveillance, and adaptive public health responses. As new variants emerge, continued investment in vaccine development, equitable healthcare access, and data transparency will be crucial to managing future public health crises.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>